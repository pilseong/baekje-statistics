<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>Baekjemuseum Tourist Statstics Input</title>
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css">


  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
  <div class="container">
    <div class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mynavbar-content1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">관람객 통계</a>
        </div>
        <div class="collapse navbar-collapse" id="mynavbar-content1">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">입력</a></li>
            <li><a href="#">보기</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="panel panel-success">
      <!-- Default panel contents -->
      <div class="panel-heading">일일 관람객 입력</div>
      <div class="panel-body">
        <p>일일 박물관 관람객 현황을 입력하여 주시기 바랍니다.</p>
      </div>

      <form class="form">
      <!-- Table -->
      <div class="form-group has-warning table-responsive">
        <table id="inputTable" class="table table-bordered table-condensed">
          <tr>
            <th>시간대</th>
            <th>소계</th>
            <th>계</th>
            <th>09-12시</th>
            <th>12-14시</th>
            <th>14-16시</th>
            <th>16-18시</th>
            <th>18-21시</th>
          </tr>
          <tr class="total">
            <td rowspan="3">합계</td>
            <td>계</td>
            <td class="sumtotal"></td>
            <td class="sumtotal"></td>
            <td class="sumtotal"></td>
            <td class="sumtotal"></td>
            <td class="sumtotal"></td>
            <td class="sumtotal"></td>
          </tr>
          <tr class="total">
            <td>개인</td>
            <td class="rowtotal"></td>
            <td class="total"></td>
            <td class="total"></td>
            <td class="total"></td>
            <td class="total"></td>
            <td class="total"></td>
          </tr>
          <tr class="total">
            <td>단체</td>
            <td class="rowtotal"></td>
            <td class="total"></td>
            <td class="total"></td>
            <td class="total"></td>
            <td class="total"></td>
            <td class="total"></td>
          </tr>
          <tr class="child">
            <td rowspan="3">어린이</td>
            <td>계</td>
            <td class="sumchild"></td>
            <td class="sumchild"></td>
            <td class="sumchild"></td>
            <td class="sumchild"></td>
            <td class="sumchild"></td>
            <td class="sumchild"></td>
          </tr>
          <tr class="child">
            <td>개인</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력" /></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="child">
            <td>단체</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="child form-control input-sm" placeholder="값입력"/></td>
          </tr>

          <tr class="teenager">
            <td rowspan="3">청소년</td>
            <td>계</td>
            <td class="sumteenager"></td>
            <td class="sumteenager"></td>
            <td class="sumteenager"></td>
            <td class="sumteenager"></td>
            <td class="sumteenager"></td>
            <td class="sumteenager"></td>
          </tr>
          <tr class="teenager">
            <td>개인</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="teenager">
            <td>단체</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="teenager form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="adult">
            <td rowspan="3">성인</td>
            <td>계</td>
            <td class="sumadult"></td>
            <td class="sumadult"></td>
            <td class="sumadult"></td>
            <td class="sumadult"></td>
            <td class="sumadult"></td>
            <td class="sumadult"></td>
          </tr>
          <tr class="adult">
            <td>개인</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="adult">
            <td>단체</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="adult form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="senior">
            <td rowspan="3">경로</td>
            <td>계</td>
            <td class="sumsenior"></td>
            <td class="sumsenior"></td>
            <td class="sumsenior"></td>
            <td class="sumsenior"></td>
            <td class="sumsenior"></td>
            <td class="sumsenior"></td>
          </tr>
          <tr class="senior">
            <td>개인</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="senior">
            <td>단체</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="senior form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="foreigner">
            <td rowspan="3">외국인</td>
            <td>계</td>
            <td class="sumforeigner"></td>
            <td class="sumforeigner"></td>
            <td class="sumforeigner"></td>
            <td class="sumforeigner"></td>
            <td class="sumforeigner"></td>
            <td class="sumforeigner"></td>
          </tr>
          <tr class="foreigner">
            <td>개인</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
          </tr>
          <tr class="foreigner">
            <td>단체</td>
            <td class="rowtotal"></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
            <td><input type="text" class="foreigner form-control input-sm" placeholder="값입력"/></td>
          </tr>
        </table>
      </div>
      <div class="form-group panel-footer">
        <button type="submit" class="btn btn-primary">등록</button>
        <button type="submit" class="btn btn-warning">수정</button>
        <button type="submit" class="pull-right btn btn-danger">삭제</button>
      </div>
      </form>
    </div>
  </div>
  <script src="js/jquery-1.12.4.min.js"></script>
  <script src="js/bootstrap.js"></script>
  <script>
    var tbl = $('#inputTable');
    tbl.find('tr').each(function() {
      $(this).find('input[type=text]').on("keyup", function(event) {
        calculateRowSum();
        calculateColumn(event);
      });
    });

    function calculateRowSum() {
      tbl.find('tr').each(function () {
        var sum = 0;
        $(this).find('input[type=text]').each(function() {
          if (!isNaN(this.value) && this.value.length != 0) {
            sum += parseFloat(this.value);
            //alert(this);
          }
        });
        $(this).find('.rowtotal').text(sum);
      });
    }

    function calculateColumn(event) {
      var arrSumOfPerTime = [[0, 0, 0, 0, 0, 0],[0, 0, 0, 0, 0, 0]];
      $childTargetTRs = $('#inputTable tr.child:not(:first)');
      setSumOfSectionValuesByTimeslots($childTargetTRs, "child", arrSumOfPerTime);

      $teenagerTargetTRs = $('#inputTable tr.teenager:not(:first)');
      setSumOfSectionValuesByTimeslots($teenagerTargetTRs, "teenager", arrSumOfPerTime);

      $adultTargetTRs = $('#inputTable tr.adult:not(:first)');
      setSumOfSectionValuesByTimeslots($adultTargetTRs, "adult", arrSumOfPerTime);

      $seniorTargetTRs = $('#inputTable tr.senior:not(:first)');
      setSumOfSectionValuesByTimeslots($seniorTargetTRs, "senior", arrSumOfPerTime);

      $foreignerTargetTRs = $('#inputTable tr.foreigner:not(:first)');
      setSumOfSectionValuesByTimeslots($foreignerTargetTRs, "foreigner", arrSumOfPerTime);

      // calcuate total sums of the visitors.
      $totalTargetTRs = $('#inputTable tr.total:not(:first)');
      setSumOfTotalValuesByTimeslots($totalTargetTRs, "total", arrSumOfPerTime);
    }

    // this function will calculate each column and add this number to the array that has the sum of
    // each section. the array is a two dimensional and each one hold the data according to group.
    // $targetTRs are trs with designated section class in the tag.
    // className is a designated section name.
    // arrSumOfPerTime is a holder for total values of all.
    function setSumOfSectionValuesByTimeslots($targetTRs, className, arrSumOfPerTime) {
      $($targetTRs[0]).find('td:not(:first)').each(function() {
        var $td       = $(this);
        var colTotal  = 0;
        var value     = 0;

        $targetTRs.each(function(index) {
          $targetTDs = $(this).find('td:not(:first)');
          if ($targetTDs.eq($td.index()-1).children().length > 0) {
            value = parseInt($targetTDs.eq($td.index()-1).find('input[type=text]').get(0).value);
          } else {
            value = parseInt($targetTDs.eq($td.index()-1).html());
          }
          if (!isNaN(value) && value.length != 0) {
            colTotal += value;
            arrSumOfPerTime[index][$td.index()-1] += value;
          }
        });
        $('#inputTable tr.' + className + ' td.sum'+className).eq($td.index()-1).html(colTotal);
      });
    }

    // This part of the program will calculate and set total sums.
    // $targetTRs are trs with total class in the tag.
    // arrSumOfPerTime is a two dimensional array that has sums of each time slot of each category(individual, group).
    function setSumOfTotalValuesByTimeslots($targetTRs, className, arrSumOfPerTime) {
      // This array will hold the total sums of the visitors. Second row of this table.
      var arrTotal = [0, 0, 0, 0, 0, 0];
      $targetTRs.each(function(row) {
        var colTotal = 0;
        $(this).find('td:not(:first)').each(function(column) {
          $(this).html(arrSumOfPerTime[row][column]);
          arrTotal[column] += arrSumOfPerTime[row][column];
        });
      });

      // Copy total sums of the visitors divided by time periods.
      tbl.find('.sumtotal').each(function(index) {
        $(this).html(arrTotal[index]);
      });
    }
  </script>
</body>
</html>
